<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fluxo ESTRAT√âGICO</title>
    <link
      rel="icon"
      href="data:image/svg+xml, <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23007bff' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'>
  <path d='M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8'/>
  <path d='M21 3v5h-5'/>
  <path d='M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16'/>
  <path d='M3 21v-5h5'/>
</svg>"
    />

    <link rel="stylesheet" href="src/css/styles.css" />
    <link rel="stylesheet" href="src/css/achievements.css" />
    <link rel="stylesheet" href="src/css/calendar.css" />
    <link rel="stylesheet" href="src/css/globalTooltip.css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.6/Sortable.min.js"
      integrity="sha512-csIng5zcB+XpulRUa+ev1zKo7zRNGpEaVfNB9On1no9KYTEY/rLGAEEpvgdw6nim1WdTuihZY1eqZ31K7/fZjw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>

  <body>
    <div class="app-container">
      <div id="screen-home">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
          "
        >
          <div
            class="logo"
            style="
              display: flex;
              align-items: center;
              gap: 10px;
              font-size: 24px;
              margin: 0;
            "
          >
            <svg
              width="40"
              height="40"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                style="display: none"
              ></path>
              <path
                d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"
              ></path>
              <path d="M21 3v5h-5"></path>
              <path
                d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"
              ></path>
              <path d="M3 21v-5h5"></path>
            </svg>
            <div>Fluxo <span>ESTRAT√âGICO</span></div>
          </div>

          <button
            id="theme-toggle"
            onclick="toggleTheme()"
            style="
              background: transparent;
              border: none;
              cursor: pointer;
              font-size: 24px;
              color: var(--text-color);
            "
          >
            üåô
          </button>
        </div>

        <div class="cycle-card" style="padding: 15px; margin-bottom: 20px">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 10px;
            "
          >
            <div style="display: flex; align-items: center; gap: 8px">
              <strong
                style="
                  font-size: 14px;
                  color: var(--text-secondary);
                  text-transform: uppercase;
                "
              >
                CONST√ÇNCIA
              </strong>

              <div>
                <span
                  class="tip-strike-icon"
                  data-tooltip="Para contabilizar um dia de estudo, 
                  voc√™ deve estudar no m√≠nimo 20 minutos."
                  data-tooltip-position="top"
                  >?</span
                >
              </div>

              <button
                class="btn-calendar-toggle"
                onclick="toggleCalendarModal()"
                title="Ver calend√°rio mensal"
                style="
                  background: none;
                  border: none;
                  font-size: 1.2rem; /* Levemente menor para alinhar melhor */
                  cursor: pointer;
                  color: var(--primary-color);
                  display: flex;
                  align-items: center;
                  padding: 0;
                "
              >
                üìÖ
              </button>
            </div>

            <small
              id="streak-count"
              style="font-weight: bold; color: var(--primary-color)"
            >
              0 dias seguidos üî•
            </small>
          </div>

          <div id="streak-visual"></div>

          <button
            class="btn btn-outline"
            onclick="showAchievements()"
            style="
              margin-top: 10px;
              border-color: #666;
              color: var(--text-color);
              width: 100%; /* Opcional: bot√£o largura total fica bom no mobile */
            "
          >
            üèÜ Conquistas
          </button>
        </div>

        <div class="cycle-card">
          <h2>Fluxo Atual</h2>
          <p style="color: var(--text-color); font-size: 14px">
            Pr√≥xima mat√©ria:
          </p>
          <h2 id="home-subject-name" style="text-transform: capitalize">
            Carregando...
          </h2>
          <div
            class="subject-badge"
            id="home-next-subject"
            style="text-transform: capitalize"
          >
            Depois: ...
          </div>

          <button class="btn" onclick="startStudy()">Estudar</button>
          <button class="btn btn-black" onclick="showConfig()">
            Configurar Fluxo
          </button>
          <button
            class="btn btn-outline"
            style="margin-top: 10px"
            onclick="showReports()"
          >
            Ver Relat√≥rios
          </button>
        </div>
      </div>

      <div id="screen-timer" class="hidden">
        <button
          class="btn-back"
          onclick="goHomeFromTimeScreen()"
          title="Voltar para o In√≠cio"
        >
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
        </button>
        <div
          class="subject-badge"
          id="timer-next-subject-display"
          style="text-transform: capitalize"
        >
          Pr√≥xima: ...
        </div>
        <br />
        <div
          class="current-subject-title"
          id="timer-subject-name"
          style="text-transform: capitalize"
        >
          Mat√©ria Atual
        </div>

        <div class="timer-display" id="timer-count">00:00:00</div>

        <button class="btn" id="btn-pause" onclick="togglePause()">
          Pausar
        </button>
        <button class="btn btn-black" onclick="finishSession()">
          Finalizar Circuito
        </button>
      </div>

      <div id="screen-finish" class="hidden">
        <h3>Concluir Circuito</h3>
        <div class="subject-badge" id="finish-subject-name">Mat√©ria</div>

        <div class="form-group">
          <label for="input-questions">Quantidade de quest√µes:</label>
          <input type="number" id="input-questions" placeholder="Ex: 10" />
        </div>
        <div class="form-group">
          <label for="input-correct">Quantidade de acertos:</label>
          <input type="number" id="input-correct" placeholder="Ex: 8" />
        </div>

        <div>
          <p
            style="
              font-size: 11px;
              color: var(--text-secondary);
              margin-top: 10px;
              text-align: justify;
            "
          >
            Nota: Voc√™ pode deixar os campos de quest√µes e acertos vazios se n√£o
            quiser registrar esse dado.
          </p>
        </div>

        <button class="btn" onclick="saveAndAdvance()">
          Concluir e avan√ßar
        </button>
      </div>

      <div id="screen-config" class="hidden">
        <div class="nav-header">
          <button
            class="btn-back"
            onclick="goHome()"
            title="Voltar para o In√≠cio"
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
          </button>
          <h2>Configura√ß√µes</h2>
        </div>

        <p style="font-size: 14px; color: var(--text-color)">
          Adicione as mat√©rias que deseja estudar.
        </p>

        <div class="form-group">
          <input
            type="text"
            id="new-subject-input"
            placeholder="Nome da mat√©ria (ex: Portugu√™s)"
          />
          <button
            class="btn btn-outline"
            onclick="addSubject()"
            style="margin-top: 15px"
          >
            Adicionar
          </button>
        </div>

        <ul class="config-list" id="config-list"></ul>

        <div
          style="
            background: var(--badge-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
          "
        >
          <p
            style="
              font-size: 14px;
              font-weight: bold;
              margin-bottom: 10px;
              color: var(--text-color);
            "
          >
            Dias de Descanso (N√£o quebra a const√¢ncia)
          </p>
          <div style="display: flex; flex-wrap: wrap; gap: 5px">
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="0" />
              Dom</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="1" />
              Seg</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="2" />
              Ter</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="3" />
              Qua</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="4" />
              Qui</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="5" />
              Sex</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="6" />
              S√°b</label
            >
          </div>
          <button
            class="btn-sm"
            onclick="saveRestDays()"
            style="
              margin-top: 15px;
              background: var(--card-bg);
              width: 100%;
              justify-content: center;
            "
          >
            Salvar Dias
          </button>
        </div>

        <button
          class="btn-sm btn-danger-text"
          onclick="clearConfig()"
          title="reseta as configura√ß√µes da pagina de configurar fluxo"
        >
          ‚ü≤ Resetar as Configura√ß√µes
        </button>

        <div
          class="table-actions"
          style="
            background: var(--badge-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            margin-top: 10px;
          "
        >
          <h3 style="font-weight: bold; margin: 10px; color: var(--text-color)">
            üì¶ Dados e Backup
          </h3>
          <span
            class="tip-strike-icon"
            data-tooltip="Fa√ßa o backup antes de limpar os dados de navega√ß√£o 
            ou caso queira mudar de navegador."
            data-tooltip-position="top"
          >
            ?
          </span>
          <p
            style="
              font-size: 13px;
              color: var(--text-color);
              margin-bottom: 15px;
            "
          >
            Gere um arquivo √∫nico contendo todo o seu hist√≥rico e configura√ß√µes
            para salvar ou transferir para outro Celular / Dispositivo.
          </p>
          <div style="display: flex; gap: 8px">
            <button class="btn-sm" onclick="exportBackupFile()">
              <span>‚òÅÔ∏è</span> Fazer Backup dos Dados
            </button>
            <button
              class="btn-sm"
              onclick="triggerImportConfig()"
              title="Use o mesmo formato do arquivo de exporta√ß√£o em .CSV"
            >
              <span>üì•</span> Restaurar Backup
            </button>
            <input
              type="file"
              id="backup-upload"
              style="display: none"
              accept=".json, .estudos, application/json, text/plain"
              onchange="importBackupFile(this)"
            />
          </div>

          <p
            style="
              font-size: 11px;
              color: #ff331e;
              margin-top: 10px;
              text-align: justify;
            "
          >
            Nota: Restaurar um backup substituir√° seus dados atuais, todos os
            dados ficam salvo localmente no seu navegador.
          </p>
        </div>
      </div>

      <div id="screen-reports" class="hidden">
        <div class="nav-header">
          <button
            class="btn-back"
            onclick="goHome()"
            title="Voltar para o In√≠cio"
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
          </button>
          <h2>Relat√≥rios</h2>
        </div>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 30px;
          "
        >
          <div id="chart-subjects" class="cycle-card chart-scroll-container">
            <h4>Desempenho por Mat√©ria</h4>
            <canvas id="chart-performance"></canvas>
          </div>

          <div
            id="rotate-tip"
            style="
              text-align: center;
              margin-bottom: 15px;
              font-size: 14px;
              color: #888;
              display: none;
            "
          ></div>

          <div class="cycle-card">
            <h4>Tempo Total por Mat√©ria (Horas)</h4>
            <canvas id="chart-time"></canvas>
          </div>
        </div>

        <h3>Hist√≥rico de Estudos</h3>

        <div class="table-container">
          <table id="history-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Mat√©ria</th>
                <th>Tempo</th>
                <th>Quest√µes</th>
                <th>Acertos</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="history-list"></tbody>
          </table>
          <p
            id="empty-history-msg"
            style="display: none; color: var(--text-color); font-size: 14px"
          >
            Nenhum registro ainda.
          </p>
        </div>

        <div class="table-actions">
          <div style="display: flex; gap: 8px"></div>

          <button
            id="btn-screen-report"
            class="btn-sm btn-danger-text"
            onclick="clearHistory()"
          >
            üóëÔ∏è Limpar tudo
          </button>
        </div>
      </div>

      <div id="screen-achievements" class="hidden">
        <div class="achievements-header" style="margin-bottom: 20px">
          <div class="nav-header">
            <button
              class="btn-back"
              onclick="goHome()"
              title="Voltar para o In√≠cio"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
            </button>
            <div style="display: flex; align-items: center; gap: 10px">
              <h2 style="margin: 0">Conquistas üèÜ</h2>
              <span
                id="ach-counter"
                style="
                  background: var(--card-bg);
                  border: 1px solid var(--border-color);
                  padding: 2px 8px;
                  border-radius: 12px;
                  font-size: 14px;
                  font-weight: bold;
                "
                >0/0</span
              >
            </div>
          </div>

          <select
            id="ach-filter"
            onchange="renderAchievementsList()"
            class="form-select"
          >
            <option value="all">Todas as Conquistas</option>
            <option value="unlocked">Apenas Desbloqueadas</option>
            <option value="locked">Apenas Bloqueadas</option>
          </select>
        </div>

        <div id="achievements-grid" class="achievements-container"></div>
      </div>
    </div>

    <div id="calendar-modal" class="modal-overlay hidden">
      <div class="modal-content calendar-box">
        <div class="calendar-header">
          <button class="cal-nav-btn" onclick="changeCalendarMonth(-1)">
            &#10094;
          </button>
          <h3 id="cal-month-year">M√™s Ano</h3>
          <button class="cal-nav-btn" onclick="changeCalendarMonth(1)">
            &#10095;
          </button>
        </div>

        <div class="calendar-weekdays">
          <div>Dom</div>
          <div>Seg</div>
          <div>Ter</div>
          <div>Qua</div>
          <div>Qui</div>
          <div>Sex</div>
          <div>S√°b</div>
        </div>

        <div id="calendar-grid" class="calendar-grid"></div>

        <div style="text-align: center; margin-top: 20px">
          <button
            class="btn btn-black"
            onclick="toggleCalendarModal()"
            style="padding: 8px 30px"
          >
            Fechar
          </button>
        </div>
      </div>
    </div>

    <div class="toast-container" id="toast-container"></div>

    <script src="src/js/tooltip.js"></script>
    <script src="src/js/globals.js"></script>
    <script src="src/js/utils.js"></script>
    <script src="src/js/reports.js"></script>
    <script src="src/js/timer.js"></script>
    <script src="src/js/toast.js"></script>
    <script src="src/js/streak.js"></script>
    <script src="src/js/achievements.js"></script>
    <script src="src/js/settings.js"></script>
    <script src="src/js/calendar.js"></script>
    <script src="src/js/app.js"></script>
  </body>
</html>
