<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fluxo ESTRAT√âGICO</title>
    <link
      rel="icon"
      href="data:image/svg+xml, <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23007bff' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'>
  <path d='M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8'/>
  <path d='M21 3v5h-5'/>
  <path d='M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16'/>
  <path d='M3 21v-5h5'/>
</svg>"
    />

    <link rel="stylesheet" href="src/css/styles.css" />
    <link rel="stylesheet" href="src/css/achievements.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.6/Sortable.min.js"
      integrity="sha512-csIng5zcB+XpulRUa+ev1zKo7zRNGpEaVfNB9On1no9KYTEY/rLGAEEpvgdw6nim1WdTuihZY1eqZ31K7/fZjw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>

  <body>
    <div class="app-container">
      <div id="screen-home">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
          "
        >
          <div
            class="logo"
            style="
              display: flex;
              align-items: center;
              gap: 10px;
              font-size: 24px;
              margin: 0;
            "
          >
            <svg
              width="40"
              height="40"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                style="display: none"
              ></path>
              <path
                d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"
              ></path>
              <path d="M21 3v5h-5"></path>
              <path
                d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"
              ></path>
              <path d="M3 21v-5h5"></path>
            </svg>
            <div>Fluxo <span>ESTRAT√âGICO</span></div>
          </div>

          <button
            id="theme-toggle"
            onclick="toggleTheme()"
            style="
              background: transparent;
              border: none;
              cursor: pointer;
              font-size: 24px;
              color: var(--text-color);
            "
          >
            üåô
          </button>
        </div>

        <div class="cycle-card" style="padding: 15px; margin-bottom: 20px">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 10px;
            "
          >
            <strong style="font-size: 14px; color: var(--text-secondary)"
              >CONST√ÇNCIA</strong
            >
            <small
              id="streak-count"
              style="font-weight: bold; color: var(--primary-color)"
              >0 dias seguidos üî•</small
            >
          </div>
          <div id="streak-visual"></div>
          <button
            class="btn btn-outline"
            onclick="showAchievements()"
            style="
              margin-top: 10px;
              border-color: #666;
              color: var(--text-color);
            "
          >
            üèÜ Conquistas
          </button>
        </div>

        <div class="cycle-card">
          <h3>Fluxo Atual</h3>
          <p style="color: var(--text-color); font-size: 14px">
            Pr√≥xima mat√©ria:
          </p>
          <h2 id="home-subject-name">Carregando...</h2>
          <div class="subject-badge" id="home-next-subject">Depois: ...</div>

          <button class="btn" onclick="startStudy()">Continuar</button>
          <button class="btn btn-black" onclick="showConfig()">
            Configurar Fluxo
          </button>
          <button
            class="btn btn-outline"
            style="margin-top: 10px"
            onclick="showReports()"
          >
            Ver Relat√≥rios
          </button>
        </div>
      </div>

      <div id="screen-timer" class="hidden">
        <div class="subject-badge" id="timer-next-subject-display">
          Pr√≥xima: ...
        </div>
        <br />
        <div class="current-subject-title" id="timer-subject-name">
          Mat√©ria Atual
        </div>

        <div class="timer-display" id="timer-count">00:00:00</div>

        <button class="btn" id="btn-pause" onclick="togglePause()">
          Pausar
        </button>
        <button class="btn btn-black" onclick="finishSession()">
          Finalizar Circuito
        </button>
      </div>

      <div id="screen-finish" class="hidden">
        <h3>Concluir Circuito</h3>
        <div class="subject-badge" id="finish-subject-name">Mat√©ria</div>

        <div class="form-group">
          <label>Quantidade de quest√µes:</label>
          <input type="number" id="input-questions" placeholder="Ex: 10" />
        </div>
        <div class="form-group">
          <label>Quantidade de acertos:</label>
          <input type="number" id="input-correct" placeholder="Ex: 8" />
        </div>

        <button class="btn" onclick="saveAndAdvance()">
          Concluir e avan√ßar
        </button>
      </div>

      <div id="screen-config" class="hidden">
        <h3>Configurar Fluxo</h3>

        <p style="font-size: 12px; color: #666">
          Adicione as mat√©rias que deseja estudar.
        </p>

        <div class="form-group">
          <input
            type="text"
            id="new-subject-input"
            placeholder="Nome da mat√©ria (ex: Portugu√™s)"
          />
          <button
            class="btn btn-outline"
            onclick="addSubject()"
            style="margin-top: 15px"
          >
            Adicionar
          </button>
        </div>

        <ul class="config-list" id="config-list"></ul>

        <div
          style="
            background: var(--badge-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
          "
        >
          <p
            style="
              font-size: 14px;
              font-weight: bold;
              margin-bottom: 10px;
              color: var(--text-color);
            "
          >
            Dias de Descanso (N√£o quebra a const√¢ncia)
          </p>
          <div style="display: flex; flex-wrap: wrap; gap: 5px">
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="0" />
              Dom</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="1" />
              Seg</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="2" />
              Ter</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="3" />
              Qua</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="4" />
              Qui</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="5" />
              Sex</label
            >
            <label class="rest-day-selector"
              ><input type="checkbox" class="rest-day-check" value="6" />
              S√°b</label
            >
          </div>
          <button
            class="btn-sm"
            onclick="saveRestDays()"
            style="
              margin-top: 15px;
              background: var(--card-bg);
              width: 100%;
              justify-content: center;
            "
          >
            Salvar Dias
          </button>
        </div>

        <div class="table-actions">
          <div style="display: flex; gap: 8px">
            <button class="btn-sm" onclick="exportConfigCSV()">
              üì§ Exportar CSV
            </button>
            <button
              class="btn-sm"
              onclick="triggerImportConfig()"
              title="Use o mesmo formato do arquivo de exporta√ß√£o em .CSV"
            >
              üì• Importar
            </button>
            <input
              type="file"
              id="import-file-config"
              style="display: none"
              accept=".csv, text/csv, text/plain */*"
              onchange="importConfigCSV(this)"
            />
          </div>
          <button class="btn-sm btn-danger-text" onclick="clearConfig()">
            üóëÔ∏è Limpar tudo
          </button>
          <p style="font-size: 12px; color: #888; margin-top: 5px;">
        O CSV deve ter as colunas: <strong>Materia</strong> e <strong>Dias_Descanso</strong> (ex: "S√°bado, Domingo").
    </p>
        </div>
        
        <button class="btn" onclick="goHome()">Voltar / Salvar</button>
      </div>

      <div id="screen-reports" class="hidden">
        <h3>Relat√≥rios de Desempenho</h3>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 30px;
          "
        >
          <div id="chart-subjects" class="cycle-card chart-scroll-container">
            <h4>Desempenho por Mat√©ria</h4>
            <canvas id="chart-performance"></canvas>
          </div>

          <div class="cycle-card">
            <h4>Tempo Total por Mat√©ria (Horas)</h4>
            <canvas id="chart-time"></canvas>
          </div>
        </div>

        <h3>Hist√≥rico de Estudos</h3>

        <div class="table-container">
          <table id="history-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Mat√©ria</th>
                <th>Tempo</th>
                <th>Quest√µes</th>
                <th>Acertos</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="history-list"></tbody>
          </table>
          <p
            id="empty-history-msg"
            style="display: none; color: var(--text-color); font-size: 14px"
          >
            Nenhum registro ainda.
          </p>
        </div>

        <div class="table-actions">
          <div style="display: flex; gap: 8px">
            <button class="btn-sm" onclick="exportToCSV()">
              üì§ Exportar CSV
            </button>
            <button
              class="btn-sm"
              onclick="triggerImport()"
              title="Use o mesmo formato do arquivo de exporta√ß√£o em .CSV"
            >
              üì• Importar
            </button>
            <input
              type="file"
              id="import-file"
              style="display: none"
              accept=".csv, text/csv, text/plain */*"
              onchange="importFromCSV(this)"
            />
          </div>

          <button class="btn-sm btn-danger-text" onclick="clearHistory()">
            üóëÔ∏è Limpar tudo
          </button>
        </div>

        <button class="btn" onclick="switchScreen('screen-home')">
          Voltar
        </button>
      </div>

      <div id="screen-achievements" class="hidden">
        <div class="achievements-header" style="margin-bottom: 20px;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <h2 style="margin:0;">Conquistas üèÜ</h2>
                <span id="ach-counter" style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 2px 8px; border-radius: 12px; font-size: 14px; font-weight: bold;">0/0</span>
            </div>
        </div>
        
        <select id="ach-filter" onchange="renderAchievementsList()" class="form-select">
            <option value="all">Todas as Conquistas</option>
            <option value="unlocked">Apenas Desbloqueadas</option>
            <option value="locked">Apenas Bloqueadas</option>
        </select>
    </div>

    <div id="achievements-grid" class="achievements-container">
        </div>

    <button class="btn btn-black" onclick="goHome()" style="margin-top: 20px;">Voltar</button>
    </div>

    <div class="toast-container" id="toast-container"></div>

    <script src="src/js/globals.js"></script>
    <script src="src/js/utils.js"></script>
    <script src="src/js/reports.js"></script>
    <script src="src/js/timer.js"></script>
    <script src="src/js/toast.js"></script>
    <script src="src/js/streak.js"></script>
    <script src="src/js/achievements.js"></script>
    <script src="src/js/settings.js"></script>
    <script src="src/js/app.js"></script>
  </body>
</html>
